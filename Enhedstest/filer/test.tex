\chapter{Test}
I dette afsnit følger selve testen.
\section{Testcases}
Dette afsnit er delt op i  2 dele. Hardware og software:\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% HARDWARE                   %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Hardware}
I dette afsnit forklares hvordan enhedstest af hardware udføres.
\subsubsection{SM}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{4.5cm} | p{8cm} |}
\hline
Case &Formål &Udførelse\\\hline
1 &Indstil Accelerometer &Der skrives 0x06 på P15[2:0]\\\hline
2 &Verificer RS232 &Der sættes en jumper mellem RX\_out og TX\_out og derefter sendes der 5 forskellige chars via UART\\\hline
\end{tabular}
\end{table}
\subsubsection{VBTE}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{4.5cm} | p{8cm} |}
\hline
Case &Formål &Udførelse\\\hline
1 &At teste ventilkreds &Der toggles 5V med 500ms interval ud fra PSoC'en på ben P0\_0 og P0\_2. Der lyttes på ventilerne for at bekræfte at de åbner og lukker.\\\hline
2 &At teste transmitterkreds &Der sendes burst ved 40kHz 0V-5V fra PSoC'en på ben P0\_1. Disse sendes med 100ms interval og der indsættes et ekstra ben mellem PGA og mixer. Der testes med Osciloskop og der bekræftes om et burst modtages ved at holde en genstand over ultralydstransmitteren og receiveren.\\\hline
\end{tabular}
\end{table}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% SOFTWARE                   %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Software}
I dette afsnit forklares hvordan enhedstests af hardware udføres.
\subsubsection{SM}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{4.5cm} | p{8cm} |}
\hline
Case &Formål &Udførelse\\\hline
1 &GetLevel &GetLevel kaldes som funktionskald med en stub. Stubben verificere returnværdien.\\\hline
2  &getFromKI &Et program køres hvor getFromKI kaldes i en while løkke. SM modulet sættes sammen med en teststub der sender 6 forskellige cases, 1000 gange.\\\hline
\end{tabular}
\end{table}
\subsubsection{VBTE}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{4.5cm} | p{8cm} |}
\hline
Case &Formål &Udførelse\\\hline
1 &SendBurst &Metoden kaldes i intervaller på 500ms og der måles med osciloskop på ben P0\_1 at der bliver sendt burst's med en varighed på $\sim$250$\mu$s og med en frekvens på $\sim$40kHz.\\\hline
2  &CalculateDistance & Metoden kaldes 100 gange med forskellige inputværdier. Outputtet ligges i et array og der valideres på disse værdier.\\\hline
3 &ConvertMMtoPercent & Metoden kaldes 100 gange med forskellige inputværdier. Outputtet ligges i et array og der valideres på disse værdier.\\\hline
4 & ChangeState & Metoden kaldes med alle forskellige slags input og 3 værdier uden for input. Der lyttes på ventilerne og der valideres om de åbner/lukker som de skal.\\\hline
5 & I2C\_handle & Der anvendes en stub der agerer som SM. Denne sender alle værdier fra protokollen samt 3 værdier uden for protokollen. Der kontrolleres om der modtages alle værdier korrekt ved at udskrive dem på displayet. Der kontrolleres også om den rigtige værdi sendes retur til SM stub'en.\\\hline
6 & I2C\_decode & Metoden kaldes med de forskellige værdier for protokollen samt 3 uden for protokollen. Returværdien kontrolleres for at validere det korrekte state.\\\hline
7 & Init & Metoden kaldes og der kontrolleres om der returneres 1 tilbage.\\\hline
\end{tabular}
\end{table}
\subsubsection{KI}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{4.5cm} | p{8cm} |}
\hline
Case &Formål &Udførelse\\\hline
3 &"AKTIVER MANUEL HÆLDNINGSREGULERING"-knappen.\\\hline
3b &At teste hvorvidt en ændret manuel vinkling sendes ud serielt. &Der indsættes en manuel vinklingsregulering på den grafiske brugergrænseflade. Alle kombinationer af side og værdi afprøves. Der verificeres i terminalen at RS232-klassen udsender værdierne til SM.\\\hline
3b &Det testes hvordan programmet reagerer hvis man efter at have trykket på "AKTIVER MANUEL HÆLDNINGSREGULERING" fortryder sit valg ved tryk på "Cancel"-knappen.\\\hline
4 &At teste hvorvidt en status struct kan requestes fra SM-klassen og sendes til databasen. SM-klassen returnerer en status-stub. Det verificeres i terminalen at dataserver-klassen udsender værdierne til databasen.\\\hline
5 &"AKTIVER AUTOMATISK HÆLDNINGSREGULERING"\\\hline
5a &Det testes hvordan programmet reagerer hvis man forsøger at aktivere automatisk regulering, når denne allerede er aktiveret. &Der trykkes på knappen "AKTIVER AUTOMATISK HÆLDNINGSREGULERING".\\\hline
5b &Det testes hvordan programmet reagerer hvis man forsøger at aktivere automatisk regulering, når denne ikke er aktiveret. &Der trykkes på knappen "AKTIVER AUTOMATISK HÆLDNINGSREGULERING".\\\hline
6 &"LUK BROS"-KNAPPEN\\\hline
6a &Det testes hvordan programmet reagerer hvis man ønsker at lukke programmet med et tryk på "LUK BROS"-knappen og efterfølgende bekræfter ved tryk på "YES"-knappen.\\\hline
6b &Det testes hvordan programmet reagerer hvis man efter tryk på "LUK BROS"-knappen fortryder sit valg og vælger "NO".\\\hline
\end{tabular}
\end{table}
% Testresultater
\section{Testresultater}
Dette afsnit er delt op i  2 dele baseret på ovenstående tests.\\
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% HARDWARE RESULTATER        %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Hardware}
I dette afsnit findes forventede resultater samt resultater på testcases fra ovenstående hardware kapitel.\\
\subsubsection{SM}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{4cm} | p{6cm} | p{1cm} |}
\hline
Case &Forventet resultat &Resultat &Status\\\hline
1 &Accelerometeret er indstillet. &Det observeres at accelerometeret er indstillet og aktivt. &\begin{Huge}$\surd$\end{Huge}\\\hline
2 &De afsendte chars bliver modtaget via UART. &De afsendte chars blev modtaget via UART. &\begin{Huge}$\surd$\end{Huge}\\\hline
\end{tabular}
\end{table}
\subsubsection{VBTE}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{4cm} | p{6cm} | p{1cm} |}
\hline
Case &Forventet resultat &Resultat &Status\\\hline
1 &Ventilerne åbner og lukker &Det høres tydeligt at ventilerne åbnes og lukkes. &\begin{Huge}$\surd$\end{Huge} \\\hline 
2 &Der ses burst på osciloskopet &Der modtages et svagere signal end først antaget. Gain i PGA justeres til og testen gennemføres igen. Testen kan herefter godkendes. &\begin{Huge}$\surd$\end{Huge} \\\hline 
\end{tabular}
\end{table}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% SOFTWARE RESULTATER        %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Software}
I dette afsnit findes forventede resultater samt resultater på testcases fra ovenstående software kapitel.\\
\subsubsection{SM}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{4cm} | p{6cm} | p{1cm} |}
\hline
Case &Forventet resultat &Resultat &Status\\\hline
1 &Level bliver returneret og verificeret &Level blev returneret og verificeret &\begin{Huge}$\surd$\end{Huge} \\\hline 
2 &teststubben printer til skærmen at alle cases er succesfulde &teststubben printede Success: 6000 &\begin{Huge}$\surd$\end{Huge} \\\hline 
\end{tabular}
\end{table}
\subsubsection{KI}
\begin{table}[H]
\centering
\begin{tabular}{| p{1cm}  | p{6cm} | p{5cm} | p{1cm} |}
\hline
Case &Forventet resultat &Resultat &Status\\\hline
3a &I terminalen aflæses det at valget er bekræftiget og at RS232-klassen udsender værdien for kommandoen og dernæst hældningen i overensstemmelse med protokollen. I programmet kan det aflæses hvilken værdi der manuelt er indstillet til &Resultatet kan ses i \ref{fig:manuResult} og stemmer overens med forventningerne. &\begin{Huge}$\surd$\end{Huge} \\\hline 
3b &Programmet vender tilbage til stadiet før det første tryk på "AKTIVER MANUEL HÆLDNINGSREGULERING" og trykket har ingen konsekvenser. &Programmet foretog sig intet i relation til trykket. &\begin{Huge}$\surd$\end{Huge} \\\hline 
4 &I terminalen udskrives status-struct-stubben. Den udskrives efterfølgende igen af dataserver-klassen som den sendes til databasen. Her sendes navnet på skibet og tiden siden sidste opdatering fra SM. Disse er tilføjet Kontrolinterface-klassen.& & \\\hline
5 &"AKTIVER AUTOMATISK HÆLDNINGSREGULERING"\\\hline
5a &Det forventes at programmet bringer en dialog op hvori der informeres om at denne reguleringstype allerede er aktiveret. &Programmet reagerede blot med dialogen. \fxnote{indsæt reference til dialog AUTO==ON}. &\begin{Huge}$\surd$\end{Huge} \\\hline 
5b &Det forventes at der popper en dialog frem hvor der skal bekræftiges at man ønsker at gå væk fra manuel hældning. Ved bekræftelser udskrives det af RS232-klassen at kommandoen er sendt. Ved annullering lukker dialogen og trykket har ingen videre konsekvens. &Dialogen kom frem og kan ses på figur \fxnote{indsæt MANUELBEKRÆFT-dialog}&\begin{Huge}$\surd$\end{Huge} \\\hline 
6 &"LUK BROS"-knappen\\\hline
6a &Det forventes at programmet sender protokolkorrekte termineringskoder til både databasen og styringsmodulet og herefter lukker ned. Hvis programmet ikke får et svar fra styringsmodulet afbrydes termineringen med en dialog med teksten:
Ingen kontakt til Styringsmodulet. Af sikkerhedsmæssige årsager kan programmet ikke lukkes". &Programmet kunne ikke lukkes ned. Se Integrationstesten for test af korrekt termineringen af programmet.\fxnote{indsæt billede af dialog} &\begin{Huge}$\surd$\end{Huge} \\\hline 
6b &Det forventes at programmet blot vender tilbage til stadiet før trykket på "LUK BROS" uden yderligere handling. &Programmet vente korrekt tilbage og foretog sig intet yderligere i forhold til trykket. &\begin{Huge}$\surd$\end{Huge} \\\hline 
\end{tabular}
\end{table}